#!/bin/sh

# Setup OS specific configuration

echo "Setting OS specific configuration"

system_type=$(uname -s)

if [ $system_type = "Darwin" ]; then
  # Configure dock
  defaults write com.apple.dock autohide -bool true
  defaults write com.apple.dock "autohide-time-modifier" -float "1.5" 
  defaults write com.apple.dock "autohide-delay" -float "0"
  killall Dock

  # Configure trackpad
  defaults write -globalDomain com.apple.swipescrolldirection -bool false

  # Empty bin items after 30 days
  defaults write com.apple.finder "FXRemoveOldTrashItems" -bool "true"
  killall Finder

  # Configure iTerm2 to use configuration from .config
  defaults write com.googlecode.iterm2 PrefsCustomFolder -string "$XDG_CONFIG_HOME/iterm2"
  defaults write com.googlecode.iterm2 LoadPrefsFromCustomFolder -bool true

  # Setup 1Password CLI SSH auth sock to be attached on all applications start
  if [[ ! -e "$XDG_CONFIG_HOME/1password/agent.sock" ]]; then
    if [ ! -d "$XDG_CONFIG_HOME/1password" ]; then
      mkdir -p "$XDG_CONFIG_HOME/1password"
    fi

    ln -s ~/Library/Group\ Containers/2BUA8C4S2C.com.1password/t/agent.sock $XDG_CONFIG_HOME/1password/agent.sock
  fi
elif [ $system_type="Linux" ]; then
  # Ensure that the system is up-to-date
  sudo pacman -Syu

  # Check if ZSH is setup as default
  if [ ! $SHELL="zsh" ]; then
    sudo pacman zsh
    chsh -s /bin/zsh
  fi

  # Setup /usr/local/opt for packages
  if [ ! -d /usr/local/opt ]; then
    sudo mkdir /usr/local/opt
    sudo chown jsawle /usr/local/opt
  fi
fi
